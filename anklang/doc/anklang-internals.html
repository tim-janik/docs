<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="The Anklang Project &lt;anklang.testbit.eu&gt;" />
  <meta name="keywords" content="Anklang, Linux, ALSA, JavaScript,
Scripting, IPC" />
  <title>ANKLANG Development Details</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #a73613; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #4c77cc; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #a73613; font-style: italic; } /* Comment */
    code span.cv { color: #a73613; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #60a0b0; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #a73613; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #4c77cc; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #a73613; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style/faketex.css" />
  <script src="style/mathjax-tex-svg.js"
  type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">ANKLANG Development Details</h1>
<p class="author">The Anklang Project &lt;<a
href="https://anklang.testbit.eu/">anklang.testbit.eu</a>&gt;</p>
<p class="date">March 2023</p>
<div class="abstract">
<div class="abstract-title">Abstract</div>
API documentation and development internals of the Anklang project.
<p class="abstract"><b style="margin: 5em 0 1em; text-align: center; display: block;">Abstract<br /></b>
API documentation and development internals of the Anklang project.</p>
</div>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#anklang-development-details"
id="toc-anklang-development-details"><span
class="toc-section-number">1</span> ANKLANG Development Details</a>
<ul>
<li><a href="#jsonipc" id="toc-jsonipc"><span
class="toc-section-number">1.1</span> Jsonipc</a>
<ul>
<li><a href="#callback-handling" id="toc-callback-handling"><span
class="toc-section-number">1.1.1</span> Callback Handling</a></li>
</ul></li>
<li><a href="#serialization" id="toc-serialization"><span
class="toc-section-number">1.2</span> Serialization</a></li>
<li><a href="#ase-class-inheritance-tree"
id="toc-ase-class-inheritance-tree"><span
class="toc-section-number">1.3</span> Ase Class Inheritance
Tree</a></li>
</ul></li>
<li><a href="#appendix" id="toc-appendix"><span
class="toc-section-number">2</span> Appendix</a>
<ul>
<li><a href="#one-dimensional-cubic-interpolation"
id="toc-one-dimensional-cubic-interpolation"><span
class="toc-section-number">2.1</span> One-dimensional Cubic
Interpolation</a></li>
<li><a href="#modifier-keys" id="toc-modifier-keys"><span
class="toc-section-number">2.2</span> Modifier Keys</a></li>
</ul></li>
</ul>
</nav>
<section id="anklang-development-details" class="level1"
data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> ANKLANG
Development Details</h1>
<p>Technically, Anklang consists of a user interface front-end based on
web technologies (HTML, SCSS, JS, Vue) and a synthesis engine backend
written in C++. The synthesis engine can load various audio rendering
plugins which are executed in audio rendering worker threads. The main
synthesis engine thread coordinates synchronization and interafces
between the engine and the UI via an IPC interface over a web-socket
that uses remote method calls and event delivery marshalled as JSON
messages.</p>
<section id="jsonipc" class="level2" data-number="1.1">
<h2 data-number="1.1"><span class="header-section-number">1.1</span>
Jsonipc</h2>
<p>Jsonipc is a header-only IPC layer that marshals C++ calls to JSON
messages defined in <a
href="https://github.com/tim-janik/anklang/blob/master/jsonipc/jsonipc.hh">jsonipc/jsonipc.hh</a>.
The needed registration code is very straight forward to write manually,
but can also be auto-genrated by using <a
href="https://github.com/tim-janik/anklang/blob/master/jsonipc/cxxjip.py">jsonipc/cxxjip.py</a>
which parses the exported API using <a
href="https://github.com/CastXML/CastXML">CastXML</a>.</p>
<p>The Anklang API for remote method calls is defined in <a
href="https://github.com/tim-janik/anklang/blob/master/ase/api.hh">api.hh</a>.
Each class with its methods, struct with its fields and enum with its
values is registered as a Jsonipc interface using conscise C++ code that
utilizes templates to derive the needed type information.</p>
<p>The corresponding Javascript code to use <code>api.hh</code> via <a
href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function">async</a>
remote method calls is generated via
<code>Jsonipc::ClassPrinter::to_string()</code> by
<code>AnklangSynthEngine --js-api</code>.</p>
<ul>
<li>[√] <code>shared_ptr&lt;Class&gt; from_json()</code> - lookup by id
in InstanceMap or use <code>Scope::make_shared</code> for
Serializable.</li>
<li>[√] <code>to_json (const shared_ptr&lt;Class&gt; &amp;p)</code> -
marshal Serializable or {id} from InstanceMap.</li>
<li>[√] <code>Class* from_json()</code> - return
<code>&amp;*shared_ptr&lt;Class&gt;</code></li>
<li>[√] <code>to_json (Class *r)</code> - supports Serializable or
<code>Class-&gt;shared_from_this()</code> wrapping.</li>
<li>[√] <code>Class&amp; from_json()</code> - return
<code>*shared_ptr&lt;Class&gt;</code>, throws on <code>nullptr</code>.
<strong>!!!</strong></li>
<li>[√] <code>to_json (const Class &amp;v)</code> - return
<code>to_json&lt;Class*&gt;()</code></li>
<li>[√] No uses are made of copy-ctor implementations.</li>
<li>[√] Need virtual ID serialization API on InstanceMap.</li>
<li>[√] Add <code>jsonvalue_as_string()</code> for debugging
purposes.</li>
</ul>
<section id="callback-handling" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1"><span class="header-section-number">1.1.1</span>
Callback Handling</h3>
<p>Javascript can register/unregister remote Callbacks with
<em>create</em> and <em>remove</em>. C++ sends events to inform about a
remote Callback being <em>called</em> or unregistered
<em>killed</em>.</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>    Jsonapi<span class="op">/</span>Trigger<span class="op">/</span>create <span class="op">(</span>id<span class="op">);</span>     <span class="co">// JS-&gt;C++</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>    Jsonapi<span class="op">/</span>Trigger<span class="op">/</span>remove <span class="op">(</span>id<span class="op">);</span>     <span class="co">// JS-&gt;C++</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>    Jsonapi<span class="op">/</span>Trigger<span class="op">/</span>_<span class="op">&lt;</span>id<span class="op">&gt;</span>  <span class="op">([...]);</span>  <span class="co">// C++-&gt;JS</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>    Jsonapi<span class="op">/</span>Trigger<span class="op">/</span>killed <span class="op">(</span>id<span class="op">);</span>     <span class="co">// C++-&gt;JS</span></span></code></pre></div>
</section>
</section>
<section id="serialization" class="level2" data-number="1.2">
<h2 data-number="1.2"><span class="header-section-number">1.2</span>
Serialization</h2>
<p>Building on <a href="#jsonipc">Jsonipc</a>, a small serializaiton
framework provided by <a
href="https://github.com/tim-janik/anklang/blob/master/ase/serialize.hh">ase/serialize.hh</a>
is used to marshal values, structs, enums and classes to/from JSON. This
is used to store preferences and project data. The intended usage is as
follows:</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cxx"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>string<span class="op"> </span>jsontext <span class="op">=</span> Ase<span class="op">::</span>json_stringify <span class="op">(</span>somevalue<span class="op">);</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">bool</span> success <span class="op">=</span> Ase<span class="op">::</span>json_parse <span class="op">(</span>jsontext<span class="op">,</span> somevalue<span class="op">);</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// The JSON root will be of type &#39;object&#39; if somevalue is a class instance</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>string<span class="op"> </span>s<span class="op">;</span>                                          <span class="co">// s contains:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(</span><span class="kw">true</span><span class="op">);</span>                              <span class="co">// true</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(-</span><span class="fl">0.17</span><span class="op">);</span>                             <span class="co">// -0.17</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(</span><span class="dv">32768</span><span class="op">);</span>                             <span class="co">// 32768</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(</span>Ase<span class="op">::</span>Error<span class="op">::</span>IO<span class="op">);</span>                    <span class="co">// &quot;Ase.Error.IO&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(</span>String <span class="op">(</span><span class="st">&quot;STRing&quot;</span><span class="op">));</span>                 <span class="co">// &quot;STRing&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(</span>ValueS <span class="op">({</span> <span class="kw">true</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="st">&quot;HI&quot;</span> <span class="op">}));</span>        <span class="co">// [true,5,&quot;HI&quot;]</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  s <span class="op">=</span> json_stringify <span class="op">(</span>ValueR <span class="op">({</span> <span class="op">{</span><span class="st">&quot;a&quot;</span><span class="op">,</span> <span class="dv">1</span><span class="op">},</span> <span class="op">{</span><span class="st">&quot;b&quot;</span><span class="op">,</span> <span class="st">&quot;B&quot;</span><span class="op">}</span> <span class="op">}));</span> <span class="co">// {&quot;a&quot;:1,&quot;b&quot;:&quot;B&quot;}</span></span></code></pre></div>
<p>In the above examples, <code>Ase::Error::IO</code> can be serialized
because it is registered as <code>Jsonipc::Enum&lt;Ase::Error&gt;</code>
with its enum values. The same works for serializable classes registered
through <code>Jsonipc::Serializable&lt;SomeClass&gt;</code>.</p>
<p>[_] Serialization of class instances will have to depend on the
Scope/InstanceMap, so instance pointers in copyable classes registered
as <code>Jsonipc::Serializable&lt;&gt;</code> can be marshalled into a
JsonValue (as <code>{$id,$class}</code> pair), then be resolved into an
InstanceP stored in an Ase::Value and from there be marshalled into an
persistent relative object link for project data storage.</p>
</section>
<section id="ase-class-inheritance-tree" class="level2"
data-number="1.3">
<h2 data-number="1.3"><span class="header-section-number">1.3</span> Ase
Class Inheritance Tree</h2>
<pre><code>Ase::SharedBase
   |
   +Ase::Emittable
      |
      +Ase::Property
      |  |
      |  +Ase::Properties::LambdaPropertyImpl
      |
      +Ase::Object
         |
         +Ase::Gadget
         |  |
         |  +Ase::Server
         |  |  |
         |  |  +Ase::ServerImpl
         |  |
         |  +Ase::Monitor
         |  |  |
         |  |  +Ase::MonitorImpl
         |  |
         |  +Ase::GadgetImpl
         |  |
         |  +Ase::Clip
         |  |  |
         |  |  +Ase::ClipImpl
         |  |
         |  +Ase::Device
         |     |
         |     +Ase::Track
         |     |  |
         |     |  +Ase::TrackImpl
         |     |
         |     +Ase::Project
         |     |  |
         |     |  +Ase::ProjectImpl
         |     |
         |     +Ase::NativeDevice
         |     |  |
         |     |  +Ase::NativeDeviceImpl
         |     |
         |     +Ase::ClapDeviceImpl
         |
         +Ase::ResourceCrawler
            |
            +Ase::FileCrawler</code></pre>
</section>
</section>
<section id="appendix" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span>
Appendix</h1>
<p> </p>
<section id="one-dimensional-cubic-interpolation" class="level2"
data-number="2.1">
<h2 data-number="2.1"><span class="header-section-number">2.1</span>
One-dimensional Cubic Interpolation</h2>
<p>With four sample values <span class="math inline">\(V_{0}\)</span>,
<span class="math inline">\(V_{1}\)</span>, <span
class="math inline">\(V_{2}\)</span> and <span
class="math inline">\(V_{3}\)</span>, cubic interpolation approximates
the curve segment connecting <span class="math inline">\(V_{1}\)</span>
and <span class="math inline">\(V_{2}\)</span>, by using the beginning
and ending slope, the curvature and the rate of curvature change to
construct a cubic polynomial.</p>
<p>The cubic polynomial starts out as:</p>
<ol class="example" type="1">
<li><span class="math inline">\(f(x) = w_{3} x^3 + w_{2} x^2 + w_{1} x +
w_{0}\)</span></li>
</ol>
<p>Where <span class="math inline">\(0 &lt;= x &lt;= 1\)</span>,
specifying the sample value of the curve segment between <span
class="math inline">\(V_{1}\)</span> and <span
class="math inline">\(V_{2}\)</span> to obtain.</p>
<p>To calculate the coefficients <span
class="math inline">\(w_{0},…,w_{3}\)</span>, we set out the following
conditions:</p>
<ol start="2" class="example" type="1">
<li><span class="math inline">\(f(0) = V_{1}\)</span></li>
<li><span class="math inline">\(f(1) = V_{2}\)</span></li>
<li><span class="math inline">\(f&#39;(0) = V_{1}&#39;\)</span></li>
<li><span class="math inline">\(f&#39;(1) = V_{2}&#39;\)</span></li>
</ol>
<p>We obtain <span class="math inline">\(V_{1}&#39;\)</span> and <span
class="math inline">\(V_{2}&#39;\)</span> from the respecting slope
triangles:</p>
<ol start="6" class="example" type="1">
<li><span class="math inline">\(V_{1}&#39; = \frac {V_{2} - V_{0}}
{2}\)</span></li>
<li><span class="math inline">\(V_{2}&#39; = \frac {V_{3} - V_{1}}
{2}\)</span></li>
</ol>
<p>With (6) → (4) and (7) → (5) we get:</p>
<ol start="8" class="example" type="1">
<li><span class="math inline">\(f&#39;(0) = \frac {V_{2} - V_{0}}
{2}\)</span></li>
<li><span class="math inline">\(f&#39;(1) = \frac {V_{3} - V_{1}}
{2}\)</span></li>
</ol>
<p>The derivation of <span class="math inline">\(f(x)\)</span> is:</p>
<ol start="10" class="example" type="1">
<li><span class="math inline">\(f&#39;(x) = 3 w_{3} x^2 + 2 w_{2} x +
w_{1}\)</span></li>
</ol>
<p>From <span class="math inline">\(x=0\)</span> → (1), i.e. (2), we
obtain <span class="math inline">\(w_{0}\)</span> and from <span
class="math inline">\(x=0\)</span> → (10), i.e. (8), we obtain <span
class="math inline">\(w_{1}\)</span>. With <span
class="math inline">\(w_{0}\)</span> and <span
class="math inline">\(w_{1}\)</span> we can solve the linear equation
system formed by (3) → (1) and (5) → (10) to obtain <span
class="math inline">\(w_{2}\)</span> and <span
class="math inline">\(w_{3}\)</span>.</p>
<p>(<span class="citation" data-cites="c_a_">@c_a_</span>)   (3) → (1):
  <span class="math inline">\(w_{3} + w_{2} + \frac {V_{2} - V_{0}} {2}
+ V_{1} = V_{2}\)</span> (<span class="citation"
data-cites="e_j_">@e_j_</span>)   (5) → (10):   <span
class="math inline">\(3 w_{3} + 2 w_{2} + \frac {V_{2} - V_{0}} {2} =
\frac {V_{3} - V_{1}} {2}\)</span></p>
<p>With the resulting coefficients:</p>
<p><span class="math display">\[
\begin{aligned}
    w_{0} &amp;= V_{1}
&amp;                                        &amp;(initial\:value)           \\
    w_{1} &amp;= \frac{V_{2} - V_{0}} {2}
&amp;                       &amp;(initial\:slope)           \\
    w_{2} &amp;= \frac{-V_{3} + 4 V_{2} - 5 V_{1} + 2 V_{0}} {2}
&amp;    &amp;(initial\:curvature)       \\
    w_{3} &amp;= \frac{V_{3} - 3 V_{2} + 3 V_{1} - V_{0}} {2}
&amp;       &amp;(rate\:change\:of\:curvature)
\end{aligned}
\]</span></p>
<p>Reformulating (1) to involve just multiplications and additions
(eliminating power), we get:</p>
<ol start="11" class="example" type="1">
<li><span class="math inline">\(f(x) = ((w_{3} x + w_{2}) x + w_{1}) x +
w_{0}\)</span></li>
</ol>
<p>Based on <span class="math inline">\(V_{0},…,V_{3}\)</span>, <span
class="math inline">\(w_{0},…,w_{3}\)</span> and (11), we can now
approximate all values of the curve segment between <span
class="math inline">\(V_{1}\)</span> and <span
class="math inline">\(V_{2}\)</span>.</p>
<p>However, for practical resampling applications where only a specific
precision is required, the number of points we need out of the curve
segment can be reduced to a finite amount. Lets assume we require <span
class="math inline">\(n\)</span> equally spread values of the curve
segment, then we can precalculate <span class="math inline">\(n\)</span>
sets of <span class="math inline">\(W_{0,…,3}[i]\)</span>, <span
class="math inline">\(i=[0,…,n]\)</span>, coefficients to speed up the
resampling calculation, trading memory for computational performance.
With <span class="math inline">\(w_{0,…,3}\)</span> in (1):</p>
<p><span class="math display">\[
\begin{alignedat} {2}
    f(x) \  &amp;= &amp;   \frac{V_{3} - 3 V_{2} + 3 V_{1} - V_{0}} 2
x^3 \  +  &amp; \\
            &amp;  &amp; \frac{-V_{3} + 4 V_{2} - 5 V_{1} + 2 V_{0}} 2
x^2 \ +  &amp; \\
            &amp;  &amp;                     \frac{V_{2} - V_{0}} 2 x
\  +  &amp; \\
            &amp;  &amp;                                   V1   \
\     &amp;
\end{alignedat}
\]</span></p>
<p>sorted for <span class="math inline">\(V_{0},…,V_{4}\)</span>, we
have:</p>
<ol start="12" class="example" type="1">
<li><span class="math display">\[\begin{aligned}
f(x) \  = \  &amp; V_{3} \  (0.5 x^3 - 0.5 x^2) \  +     &amp; \\
          &amp; V_{2} \  (-1.5 x^3 + 2 x^2 + 0.5 x) \  +  &amp; \\
          &amp; V_{1} \  (1.5 x^3 - 2.5 x^2 + 1) \  + &amp; \\
          &amp; V_{0} \  (-0.5 x^3 + x^2 - 0.5 x)     &amp;
\end{aligned}\]</span></li>
</ol>
<p>With (12) we can solve <span class="math inline">\(f(x)\)</span> for
all <span class="math inline">\(x = \frac i n\)</span>, where <span
class="math inline">\(i = [0, 1, 2, …, n]\)</span> by substituting <span
class="math inline">\(g(i) = f(\frac i n)\)</span> with</p>
<ol start="13" class="example" type="1">
<li><span class="math inline">\(g(i) = V_{3} W_{3}[i] + V_{2} W_{2}[i] +
V_{1} W_{1}[i] + V_{0} W_{0}[i]\)</span></li>
</ol>
<p>and using <span class="math inline">\(n\)</span> precalculated
coefficients <span class="math inline">\(W_{0,…,3}\)</span> according
to:</p>
<p><span class="math display">\[
\begin{alignedat}{4}
        m      &amp;= \frac i n                                \\
        W_{3}[i] &amp;=&amp;  0.5 m^3 &amp; - &amp; 0.5 m^2
&amp;         &amp;      \\
        W_{2}[i] &amp;=&amp; -1.5 m^3 &amp; + &amp;   2 m^2 &amp; + 0.5
m &amp;      \\
        W_{1}[i] &amp;=&amp;  1.5 m^3 &amp; - &amp; 2.5 m^2
&amp;         &amp; + 1  \\
        W_{0}[i] &amp;=&amp; -0.5 m^3 &amp; + &amp;     m^2 &amp; - 0.5
m &amp;
\end{alignedat}
\]</span></p>
<p>We now need to setup <span
class="math inline">\(W_{0,…,3}[0,…,n]\)</span> only once, and are then
able to obtain up to <span class="math inline">\(n\)</span>
approximation values of the curve segment between <span
class="math inline">\(V_{1}\)</span> and <span
class="math inline">\(V_{2}\)</span> with four multiplications and three
additions using (13), given <span
class="math inline">\(V_{0},…,V_{3}\)</span>.</p>
</section>
<section id="modifier-keys" class="level2" data-number="2.2">
<h2 data-number="2.2"><span class="header-section-number">2.2</span>
Modifier Keys</h2>
<p>There seems to be a lot of inconsistency in the behaviour of
modifiers (shift and/or control) with regards to GUI operations like
selections and drag and drop behaviour.</p>
<p>According to the Gtk+ implementation, modifiers relate to DND
operations according to the following list:</p>
<table>
<caption>GDK drag-and-drop modifier keys</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Modifier</th>
<th></th>
<th style="text-align: left;">Operation</th>
<th style="text-align: left;">Note / X-Cursor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">none</td>
<td>→</td>
<td style="text-align: left;">copy</td>
<td style="text-align: left;">(else move (else link))</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>SHIFT</code></td>
<td>→</td>
<td style="text-align: left;">move</td>
<td style="text-align: left;"><code>GDK_FLEUR</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>CTRL</code></td>
<td>→</td>
<td style="text-align: left;">copy</td>
<td style="text-align: left;"><code>GDK_PLUS</code>,
<code>GDK_CROSS</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>SHIFT+CTRL</code></td>
<td>→</td>
<td style="text-align: left;">link</td>
<td style="text-align: left;"><code>GDK_UL_ANGLE</code></td>
</tr>
</tbody>
</table>
<p>Regarding selections, the following email provides a short
summary:</p>
<blockquote>
<pre><code>From: Tim Janik &lt;timj@gtk.org&gt;
To: Hacking Gnomes &lt;Gnome-Hackers@gnome.org&gt;
Subject: modifiers for the second selection
Message-ID: &lt;Pine.LNX.4.21.0207111747190.12292-100000@rabbit.birnet.private&gt;
Date: Thu, 11 Jul 2002 18:10:52 +0200 (CEST)

hi all,

in the course of reimplementing drag-selection for a widget,
i did a small survey of modifier behaviour in other (gnome/
gtk) programs and had to figure that there&#39;s no current
standard behaviour to adhere to:

for all applications, the first selection works as
expected, i.e. press-drag-release selects the region
(box) the mouse was draged over. also, starting a new
selection without pressing any modifiers simply replaces
the first one. differences occour when holding a modifier
(shift or ctrl) when starting the second selection.

Gimp:
Shift upon button press:        the new seleciton is added to the existing one
Ctrl upon button press:         the new selection is subtracted from the
                                existing one
Shift during drag:              the selection area (box or circle) has fixed
                                aspect ratio
Ctrl during drag:               the position of the initial button press
                                serves as center of the selected box/circle,
                                rather than the upper left corner

Gnumeric:
Shift upon button press:        the first selection is resized
Ctrl upon button press:         the new seleciton is added to the existing one

Abiword (selecting text regions):
Shift upon button press:        the first selection is resized
Ctrl upon button press:         triggers a compound (word) selection that
                                replaces the first selection

Mozilla (selecting text regions):
Shift upon button press:        the first selection is resized

Nautilus:
Shift or Ctrl upon buttn press: the new selection is added to or subtracted
                                from the first selection, depending on whether
                                the newly selected region was selected before.
                                i.e. implementing XOR integration of the newly
                                selected area into the first.

i&#39;m not pointing this out to start a flame war over what selection style
is good or bad and i do realize that different applications have
different needs (i.e. abiword does need compound selection, and
the aspect-ratio/centering style for gimp wouldn&#39;t make too much
sense for text), but i think for the benfit of the (new) users,
there should me more consistency regarding modifier association
with adding/subtracting/resizing/xoring to/from existing selections.

---
ciaoTJ</code></pre>
</blockquote>
</section>
</section>

<script type="text/javascript">
// This Source Code Form is licensed MPL-2.0: http://mozilla.org/MPL/2.0
window.addEventListener ("load", function() {
  // substitute dl:has(dl, ol, ul) selector
  for (const dl of document.body.querySelectorAll ('dl'))
    if (dl.querySelector ('dl, ol, ul') !== null)
      dl.setAttribute ('data-has-nestedlayout', 1);
});
</script>
</body>
</html>
